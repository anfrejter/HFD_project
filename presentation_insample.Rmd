---
title: "Quantitative strategies on High Frequency Data"
subtitle: "submission of research project -- SAMPLE PRESENTATION"
author: "Team members: Katarzyna Dybcio430189 and Quoc Frejter 430201"
date: "Academic year 2024/2025"
output: ioslides_presentation
fontsize: 12pt
---

## Approaches undertaken

In the optimization process, several methods were applied across different asset groups to identify optimal parameter combinations for high-frequency trading strategies. Three main entry techniques were tested: **Moving Average (MA), Volatility Breakout (VB), and Double Volatility Breakout (2VB).**

Moving Average strategy used slow and fast moving averages as signals for entering or exiting trades. The Volatility Breakout strategy relied on volatility measures combined with predefined thresholds to generate trading signals. The Double Volatility Breakout strategy introduced stricter entry and exit conditions with separate thresholds to ensure better control over market positioning.

The code implements three types of trading strategies: **momentum (mom)**, **mean reversion (mr)**, **and a dynamic regime-based strategy** (**fl**). The momentum strategy follows trends by taking a long position when the fast moving average is above the slow moving average and a short position otherwise. The mean reversion strategy works in the opposite direction, assuming prices will revert to the mean, taking a short position when the fast moving average is above the slow one. The regime-based strategy dynamically switches between momentum and mean reversion based on the market regime detected using a window and threshold. If the regime indicates a trending market, it applies momentum; otherwise, it applies mean reversion, making it adaptive to market conditions.

For both sets of assets we considered following parameters in our strategies:

1.  **Memory of Moving Averages**:

    -   `fast_ma`: The lookback period for the fast-moving average (short-term memory) (1-100).

    -   `ma_diff`: The difference between the fast and slow moving averages, effectively controlling the lookback period for the slow-moving average (1-100).

2.  **Types of Moving Averages**:

    -   `signal_estimator`: Defines whether to use the **mean** or **median** as the moving average calculation method.

3.  **Volatility Parameters**:

    -   `volat_param`: The lookback period to calculate volatility (2-100).

    -   `treshold_vol`: Threshold for volatility breakout detection in the Volatility Breakout strategy.

4.  **Double Volatility Breakout Parameters**:

    -   `m_exit`: Defines the exit threshold for the strategy based on volatility (0.1-3).

    -   `m_diff`: Controls the difference threshold for double breakout detection(0.1-3).

5.  **Regime-Based Parameters**:

    -   `window_regime`: The lookback period for determining market regimes (2-100).

    -   `treshold_regime`: Threshold for identifying whether the market is trending or ranging, which switches between momentum and mean reversion strategies (0-0.6).

**The parameter optimization process was conducted using Optuna in Python**, a hyperparameter optimization framework. The search involved defining a parameter space for moving averages, volatility windows, and thresholds, with each strategy's performance evaluated as an objective function based on metrics like net profit and Sharpe ratio. Optuna dynamically adjusted parameters during trials to explore high-performing combinations, and results were logged for detailed post-optimization analysis. Each asset group underwent separate optimization to ensure parameters were tailored to the unique characteristics of the data.

## Finally selected strategy for **group 1**

The **Volatility Breakout (VB)** strategy for Group 1 assets (SP and NQ) was chosen. We trade each of selected assets separately and treat them as a portfolio (applying different strategy for each asset). Strategy is based on detecting price breakouts using a combination of moving averages (e.g., for SP: MA18 and MA78, for NQ: MA5 and MA63) and volatility parameters (`volat_param = 100` for SP and `volat_param = 88` for NQ). Signals are smoothed using the median estimator, and regime detection is performed via rolling windows (`window_regime = 43` for SP, `window_regime=41` for NQ). We applied momentum strategy.

```{r, echo = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
for (selected_quarter in c("2022_Q1",
                           "2022_Q3", "2022_Q4", 
                           "2023_Q2", "2023_Q4", 
                           "2024_Q1", "2024_Q2"
)) {
    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)
}


```

## Summary of results for **group 1**

```{r, echo = F}
as_tibble(stats_all_gr1)
```

your comments required !!!

## PnL of results for **group 1** -- quarter 2022Q1

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2022_Q1"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)
  

```

your comments required !!!

## PnL of results for **group 1** -- quarter 2022Q3

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2022_Q3"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)

```

your comments required !!!

## PnL of results for **group 1** -- quarter 2022Q4

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2022_Q4"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)
```

your comments required !!!

## PnL of results for **group 1** -- quarter 2023Q2

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2023_Q2"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)

```

your comments required !!!

## PnL of results for **group 1** -- quarter 2023Q4

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2023_Q4"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)

```

your comments required !!!

## PnL of results for **group 1** -- quarter 2024Q1

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2024_Q1"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)
```

your comments required !!!

## PnL of results for **group 1** -- quarter 2024Q2

```{r, echo = F, warning = F, message = F}
source("helpers/strategies.R")
source("helpers/plots.R")

# calculate data for group1
#18,60,median,43,0.10757000000000001,100,1.7976700000000003,SP,1,50,12
fast_ma_1 <- 18
slow_ma_1 <- fast_ma_1 + 60
signal_estimator1 <- "median"
window_regime1 <- 43
treshold_regime1 <- 0.10757000000000001
volat_param1 <- 100
m_1 <- 1.7976700000000003
#m_entry1 <- 0.9569500000000001
#m_diff1 <- 0.29624000000000006
#m_exit1 <- m_entry1+m_diff1
p_val1 <- 50
tr_cost1 <- 12

#5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma_2 <- 5
slow_ma_2 <- fast_ma_2 + 58
signal_estimator2 <- "median"
window_regime2 <- 41
treshold_regime2 <- 0.17525000000000002
volat_param2 <- 88
m_2 <- 2.6238500000000005
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1<-c()
data_all_inst1_<-c()
data_all_inst2_<-c()
selected_quarter <- "2024_Q2"

    message(selected_quarter)

    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))
    res_vb1 <- get_pnl_vb(
        prices = data.group1$SP,
        group = 1,
        slow_param = slow_ma_1,
        fast_param = fast_ma_1,
        volat_param = volat_param1,
        m_ = m_1,
        #m_entry = m_entry1,
        #m_exit = m_exit1,
        p_val = p_val1,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )
    res_vb2 <- get_pnl_vb(
        prices = data.group1$NQ,
        group = 1,
        slow_param = slow_ma_2,
        fast_param = fast_ma_2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )
    
    daily_pnl_net1<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross1<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans1<-sum_to_daily(res_vb1$n_trans_fl)
    
    daily_pnl_net2<-sum_to_daily(res_vb1$pnl_net_fl)
    daily_pnl_gross2<-sum_to_daily(res_vb1$pnl_gross_fl)
    daily_trans2<-sum_to_daily(res_vb1$n_trans_fl)
    
    stats_res <- get_statistics(daily_pnl_gross1+daily_pnl_gross2,
                   daily_pnl_net1+daily_pnl_net2,
                   daily_trans1+daily_trans2,
                   add_info = TRUE)
    
    stats_tmp <- cbind(selected_quarter,stats_res)
    stats_all_gr1 <-rbind(stats_all_gr1,stats_tmp)
    
    data_all_inst1_<-rbind(data_all_inst1_,res_vb1)
    data_all_inst2_<-rbind(data_all_inst2_,res_vb2)


data_all_inst1_
data_all_inst2_

plot(
  cbind(cumsum(data_all_inst1_$pnl_net_fl + data_all_inst2_$pnl_net_fl),
        cumsum(data_all_inst1_$pnl_gross_fl + data_all_inst2_$pnl_gross_fl)),
  main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
  col = c("blue", "green"),  # Kolory dla dwóch linii
  xlab = "Time",  # Etykieta osi X
  ylab = "Cumulative PnL",  # Etykieta osi Y
  lwd = 2,

)

```

your comments required !!!

## Finally selected strategy for **group 2**

Provide a **general summary** (approach and a set of **final parameters**) for assets from **group 2**. (e.g. momentum strategy, cross over of two exponential moving averages EMA10 and EMA60 - if DIFFERENT strategy used for each asset, you should explain EACH separately.).

```{=html}
<!-- here you can include code chunk that applies the strategy for group 1 and calculates all the summary statistics
-->
```
```{r, echo = F, warning = F, message = F}
# here you can refer to the R codes that apply the strategy
# for asset group 2 to all quarters (in a loop)

#source("apply_my_strategy_group2.R")
```

## Summary of results for **group 2**

```{r, echo = F}
names(quarter_stats.all.group2)[5] <- "av.ntrades"
column_spec(
kable_styling(kable(quarter_stats.all.group2[, -2], 
                    "html", 
                    digits = 2,
                    align = "r"),
             font_size = 20),
1:7, width = "30em")

# more options here:
# https://haozhu233.github.io/kableExtra/awesome_table_in_html.html
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2022Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2022_Q1.png")

```

your comments required !!!

## PnL of results for **group 2** -- quarter 2022Q3

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2022_Q3.png")

```

your comments required !!!

## PnL of results for **group 2** -- quarter 2022Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2022_Q4.png")

```

your comments required !!!

## PnL of results for **group 2** -- quarter 2023Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2023_Q2.png")

```

your comments required !!!

## PnL of results for **group 2** -- quarter 2023Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2023_Q4.png")

```

your comments required !!!

## PnL of results for **group 2** -- quarter 2024Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2024_Q1.png")

```

your comments required !!!

## PnL of results for **group 2** -- quarter 2024Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2024_Q2.png")

```

your comments required !!!

## Summary and conclusions

Here you should include a summary of obtained results and some conclusions.
