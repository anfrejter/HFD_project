---
title: "Quantitative strategies on High Frequency Data"
subtitle: "submission of research project -- SAMPLE PRESENTATION"
author: "Team members: Katarzyna Dybcio430189 and Quoc Frejter 430201"
date: "Academic year 2024/2025"
output: ioslides_presentation
fontsize: 12pt
---

## Approaches undertaken

In the optimization process, several methods were applied across different asset groups to identify optimal parameter combinations for high-frequency trading strategies. Three main entry techniques were tested: **Moving Average (MA), Volatility Breakout (VB), and Double Volatility Breakout (2VB).**

Moving Average strategy used slow and fast moving averages as signals for entering or exiting trades. The Volatility Breakout strategy relied on volatility measures combined with predefined thresholds to generate trading signals. The Double Volatility Breakout strategy introduced stricter entry and exit conditions with separate thresholds to ensure better control over market positioning.

The code implements three types of trading strategies: **momentum (mom)**, **mean reversion (mr)**, **and a dynamic regime-based strategy** (**fl**). The momentum strategy follows trends by taking a long position when the fast moving average is above the slow moving average and a short position otherwise. The mean reversion strategy works in the opposite direction, assuming prices will revert to the mean, taking a short position when the fast moving average is above the slow one. The regime-based strategy dynamically switches between momentum and mean reversion based on the market regime detected using a window and threshold. If the regime indicates a trending market, it applies momentum; otherwise, it applies mean reversion, making it adaptive to market conditions.

For both sets of assets we considered following parameters in our strategies:

1.  **Memory of Moving Averages**:

    -   `fast_ma`: The lookback period for the fast-moving average (short-term memory) (1-100).

    -   `ma_diff`: The difference between the fast and slow moving averages, effectively controlling the lookback period for the slow-moving average (1-100).

2.  **Types of Moving Averages**:

    -   `signal_estimator`: Defines whether to use the **mean** or **median** as the moving average calculation method.

3.  **Volatility Parameters**:

    -   `volat_param`: The lookback period to calculate volatility (2-100).

    -   `treshold_vol`: Threshold for volatility breakout detection in the Volatility Breakout strategy.

4.  **Double Volatility Breakout Parameters**:

    -   `m_exit`: Defines the exit threshold for the strategy based on volatility (0.1-3).

    -   `m_diff`: Controls the difference threshold for double breakout detection(0.1-3).

5.  **Regime-Based Parameters**:

    -   `window_regime`: The lookback period for determining market regimes (2-100).

    -   `treshold_regime`: Threshold for identifying whether the market is trending or ranging, which switches between momentum and mean reversion strategies (0-0.6).

**The parameter optimization process was conducted using Optuna in Python**, a hyperparameter optimization framework. The search involved defining a parameter space for moving averages, volatility windows, and thresholds, with each strategy's performance evaluated as an objective function based on metrics like net profit and Sharpe ratio. Optuna dynamically adjusted parameters during trials to explore high-performing combinations, and results were logged for detailed post-optimization analysis. Each asset group underwent separate optimization to ensure parameters were tailored to the unique characteristics of the data.

## Finally selected strategy for **group 1**

The **Volatility Breakout (VB)** strategy for Group 1 assets was chosen. We trade only one selected assets NQ. Strategy is based on detecting price breakouts using a combination of moving averages (e.g., for SP MA57 and MA114) and volatility parameters ( `volat_param = 68` ). Signals are smoothed using the mean estimator, and regime detection is performed via rolling windows (`window_regime = 40` ). We dynamic regime-based strategy (fl).

```{r, echo = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")

fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()

for (selected_quarter in c(
    "2022_Q1",
    "2022_Q3", "2022_Q4",
    "2023_Q2", "2023_Q4",
    "2024_Q1", "2024_Q2"
)) {
    filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

    load(filename_)

    data.group1 <- get(paste0("data1_", selected_quarter))

    res_vb2 <- get_pnl_vb(
        prices = data.group1[, c(instrument_name2)],
        group = 1,
        slow_param = slow_ma2,
        fast_param = fast_ma2,
        volat_param = volat_param2,
        m_ = m_2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )

    daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

    stats_res <- get_statistics(daily_2$daily_pnl_gross,
        daily_2$daily_pnl_net,
        daily_2$daily_n_trans,
        add_info = TRUE
    )

    stats_res <- cbind(selected_quarter, stats_res)
    stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
    data_all_inst2 <- rbind(data_all_inst2, res_vb2)
}

fast_ma1 <- 51
ma_diff1 <- 89
slow_ma1 <- fast_ma1 + ma_diff1
signal_estimator1 <- "mean"
window_regime1 <- 98
treshold_regime1 <- 0.07867
instrument_name1 <- "XAG"
group_data1 <- 2
volat_param1 <- 72
m_exit1 <- 1.79056
m_diff1 <- 1.84808
m_entry1 <- m_exit1 + m_diff1
p_val1 <- 5000
tr_cost1 <- 10

fast_ma2 <- 58
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "median"
window_regime2 <- 22
treshold_regime2 <- 0.57713
instrument_name2 <- "XAU"
group_data2 <- 2
volat_param2 <- 73
# m_2 <- 2.66573
m_exit2 <- 0.10742
m_diff2 <- 1.91858
m_entry2 <- m_exit2 + m_diff2
p_val2 <- 100
tr_cost2 <- 15

stats_all_gr2 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()

for (selected_quarter in c(
    "2022_Q1", "2022_Q3", "2022_Q4",
    "2023_Q2", "2023_Q4",
    "2024_Q1", "2024_Q2"
)) {
    filename_ <- paste0("Dataset2/data2_", selected_quarter, ".RData")

    load(filename_)

    data.group2 <- get(paste0("data2_", selected_quarter))

    res_vb1 <- get_pnl_2vb(
        prices = data.group2[, c(instrument_name1)],
        group = 2,
        slow_param = slow_ma1,
        fast_param = fast_ma1,
        volat_param = volat_param1,
        # m_ = m_1,
        m_exit = m_exit1,
        m_entry = m_entry1,
        p_val = p_val1,
        tr_cost = tr_cost1,
        scale_ = 252,
        signal_estimator = signal_estimator1,
        window_regime = window_regime1,
        treshold_regime = treshold_regime1,
        add_info = TRUE,
        add_stats = FALSE
    )

    res_vb2 <- get_pnl_2vb(
        prices = data.group2[, c(instrument_name1)],
        group = 2,
        slow_param = slow_ma2,
        fast_param = fast_ma2,
        volat_param = volat_param2,
        # m_ = m_1,
        m_exit = m_exit2,
        m_entry = m_entry2,
        p_val = p_val2,
        tr_cost = tr_cost2,
        scale_ = 252,
        signal_estimator = signal_estimator2,
        window_regime = window_regime2,
        treshold_regime = treshold_regime2,
        add_info = TRUE,
        add_stats = FALSE
    )

    daily_1 <- get_pnl(res_vb1$pos_fl, data.group2[, c(instrument_name1)], p_val1, tr_cost1, add_info = FALSE)

    daily_2 <- get_pnl(res_vb2$pos_fl, data.group2[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

    stats_res <- get_statistics(daily_1$daily_pnl_gross,
        daily_1$daily_pnl_net + daily_2$daily_pnl_net,
        daily_1$daily_n_trans,
        add_info = TRUE
    )

    stats_res <- cbind(selected_quarter, stats_res)
    stats_all_gr2 <- rbind(stats_all_gr2, stats_res)
    data_all_inst1 <- rbind(data_all_inst1, res_vb1)
}
```

## Summary of results for **group 1**

```{r, echo = F}
as_tibble(stats_all_gr1)
```

The results for both "gross" and "net" indicators show significant variability, with notable declines in 2023 and the first half of 2024. Specifically, 2023_Q4 and 2024_Q1 and 2024_Q2 exhibit negative values, suggesting a decrease in performance during the analyzed period.

## PnL of results for **group 1** -- quarter 2022Q1

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2022_Q1"

fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)

plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from January 3, 2022, to March 31, 2022. It reveals that the PnL generally increases over time, with intermittent drops, ultimately reaching a value of over 8,000.

## PnL of results for **group 1** -- quarter 2022Q3

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2022_Q3"

fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()


message(selected_quarter)

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)



plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from July 1, 2022, to September 31, 2022. It reveals that the PnL generally increases over time, with intermittent drops, ultimately reaching a value of over 15,000.

## PnL of results for **group 1** -- quarter 2022Q4

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2022_Q4"

fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()


message(selected_quarter)

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)



plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from October 3, 2022, to December 30, 2022. It reveals that the PnL generally increases over time, with intermittent drops, ultimately reaching a value of over 10,000.

## PnL of results for **group 1** -- quarter 2023Q2

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2023_Q2"

fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()


message(selected_quarter)

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)



plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from April 3 ,2023 , to June 30, 2023. It reveals that the PnL generally increases over time, with intermittent drops, ultimately reaching a value of almost 4,000 net.

## PnL of results for **group 1** -- quarter 2023Q4

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2023_Q4"

# 5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
# m_exit2 <- 2.65975
# m_diff2 <- 1.44789
# m_entry2 <- m_exit2 + m_diff2
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()


message(selected_quarter)

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)



plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from October 2 ,2023 , to December 29, 2023. It reveals that the PnL generally decreases over time, ultimately reaching a value of over -6,000 net.

## PnL of results for **group 1** -- quarter 2024Q1

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2024_Q1"

# 5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
# m_exit2 <- 2.65975
# m_diff2 <- 1.44789
# m_entry2 <- m_exit2 + m_diff2
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()


message(selected_quarter)

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)



plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from January 2 ,2024 , to March 25, 2024. It reveals that the PnL generally decreases over time, ultimately reaching a value of almost -2,000.

## PnL of results for **group 1** -- quarter 2024Q2

```{r, echo = F, warning = F, message = F}
library(kableExtra)
source("helpers/strategies.R")
source("helpers/plots.R")
selected_quarter <- "2024_Q2"

# 5,58,median,41,0.17525000000000002,88,2.6238500000000005,NQ,1,20,12
fast_ma2 <- 57
ma_diff2 <- 57
slow_ma2 <- fast_ma2 + ma_diff2
signal_estimator2 <- "mean"
window_regime2 <- 40
treshold_regime2 <- 0.64827
instrument_name2 <- "NQ"
group_data2 <- 1
volat_param2 <- 68
m_2 <- 2.66573
# m_exit2 <- 2.65975
# m_diff2 <- 1.44789
# m_entry2 <- m_exit2 + m_diff2
p_val2 <- 20
tr_cost2 <- 12

stats_all_gr1 <- c()
data_all_inst1 <- c()
data_all_inst2 <- c()


message(selected_quarter)

filename_ <- paste0("Dataset1/data1_", selected_quarter, ".RData")

load(filename_)

data.group1 <- get(paste0("data1_", selected_quarter))

res_vb2 <- get_pnl_vb(
    prices = data.group1[, c(instrument_name2)],
    group = 1,
    slow_param = slow_ma2,
    fast_param = fast_ma2,
    volat_param = volat_param2,
    m_ = m_2,
    p_val = p_val2,
    tr_cost = tr_cost2,
    scale_ = 252,
    signal_estimator = signal_estimator2,
    window_regime = window_regime2,
    treshold_regime = treshold_regime2,
    add_info = TRUE,
    add_stats = FALSE
)

daily_2 <- get_pnl(res_vb2$pos_fl, data.group1[, c(instrument_name2)], p_val2, tr_cost2, add_info = FALSE)

stats_res <- get_statistics(daily_2$daily_pnl_gross,
    daily_2$daily_pnl_net,
    daily_2$daily_n_trans,
    add_info = TRUE
)

stats_res <- cbind(selected_quarter, stats_res)
stats_all_gr1 <- rbind(stats_all_gr1, stats_res)
data_all_inst2 <- rbind(data_all_inst2, res_vb2)



plot(
    cbind(
        cumsum(data_all_inst2$pnl_net_fl),
        cumsum(data_all_inst2$pnl_gross_fl)
    ),
    main = "Cumulative PnL (Net and Gross)", # Tytuł wykresu
    col = c("blue", "green"), # Kolory dla dwóch linii
    xlab = "Time", # Etykieta osi X
    ylab = "Cumulative PnL", # Etykieta osi Y
    lwd = 2,
)
```

The chart shows the cumulative Net and Gross PnL over the period from April 1 ,2024 , to June 28, 2024. It reveals that the PnL generally decreases over time, ultimately reaching a value of -5,000.

## Finally selected strategy for **group 2**

Provide a **general summary** (approach and a set of **final parameters**) for assets from **group 2**. (e.g. momentum strategy, cross over of two exponential moving averages EMA10 and EMA60 - if DIFFERENT strategy used for each asset, you should explain EACH separately.).

```{=html}
<!-- here you can include code chunk that applies the strategy for group 1 and calculates all the summary statistics
-->
```
```{r, echo = F, warning = F, message = F}
# here you can refer to the R codes that apply the strategy
# for asset group 2 to all quarters (in a loop)

# source("apply_my_strategy_group2.R")
```

## Summary of results for **group 2**

```{r, echo = F}
names(quarter_stats.all.group2)[5] <- "av.ntrades"
column_spec(
    kable_styling(
        kable(quarter_stats.all.group2[, -2],
            "html",
            digits = 2,
            align = "r"
        ),
        font_size = 20
    ),
    1:7,
    width = "30em"
)

# more options here:
# https://haozhu233.github.io/kableExtra/awesome_table_in_html.html
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2022Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2022_Q1.png")
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2022Q3

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2022_Q3.png")
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2022Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2022_Q4.png")
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2023Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2023_Q2.png")
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2023Q4

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2023_Q4.png")
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2024Q1

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2024_Q1.png")
```

your comments required !!!

## PnL of results for **group 2** -- quarter 2024Q2

```{r, echo = F, out.width ='100%'}
knitr::include_graphics("pnl_group2_2024_Q2.png")
```

your comments required !!!

## Summary and conclusions

Here you should include a summary of obtained results and some conclusions.
